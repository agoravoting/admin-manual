---
id: smart-link-auth
title: SmartLink Authentication
sidebar_label: SmartLink Authentication
slug: /integrations/smart-link-auth
---

## Introduction

In this document we will explain everything you need to know about SmartLink 
authentication mechanism: what it is, what it provides, how it works, and how
to use it.

## What it is

SmartLink is a Single sign-on (SSO) authentication mechanism provided by the 
nVotes platform with an authentication token that uses a Keyed 
[HMAC](https://en.wikipedia.org/wiki/HMAC). It allows you to send voters that 
are already authenticated  in your own platform or website to a voting link 
in a specific election without forcing them to authenticate again in nVotes 
Platform. It is secure and simple  way to implement Single sign-on.

:::note Other Single sign-one methods
nVotes Platform also supports the OpenID Connect authentication method 
to implement Single sign-on. 
[More details here](../file-formats/election-creation-json#census-auth_method).
:::

## How it works

SmartLink is a native authentication method in nVotes platform. Voters will be 
authenticated through a seccure authentication token (the `auth-token`), but 
**authorization is still done by nVotes platform**. This means that you still 
need to upload the census in nVotes platform.

The authentication flow compromises the following steps:
1. Voters are asumed to start by being already authenticated in your website or 
platform (the `external application`).
2. In the external application, voters launch the action to vote, and this 
redirects them to a SmartLink in nVotes Platform.
3. The nVotes platform loads the SmartLink, performing authentication and 
authorization and automatically redirecting to the voting booth.

### The `auth-token`

The auth-token is generated in the external application, and verified by nVotes
platform. It is a cryptographically secure to transmit information between the 
external application and nVotes plataform.

The following data is securely transmitted through the auth-token:
- `user-id`: An unique identifier string of the voter. This is the way nVotes
platform matches the user with the previously census loaded in the election.
- `election-id`: The election in which the voter will be authenticated in and
in which he is eligible to participate.
- `timestamp`: Timestamp in which the token was generated. It allows the toke
to expire.

There are some other related data fields, but we will delve into the details 
later. 

All this data is signed by the usage of a keyed hash-based message 
authentication code (also called a keyed 
[HMAC](https://en.wikipedia.org/wiki/HMAC)). Briefly, an HMAC is cryptographic
mechanism that uses the fact that 
[hash functions](https://en.wikipedia.org/wiki/Hash_function) are 
[one-way functions](https://en.wikipedia.org/wiki/One-way_function) to use the
hashing as a secure signature mechanism. A one-way function is a function that
is easy to calculate in one direction, but difficult or impossible to calculate
in the opposite direction. Hash functions are one-way functions.

The external application will generate the message to be signed, then hash it
using the HMAC mechanism and the HMAC hash signature. The auth-token is 
composed by both the message and the HMAC hash.

We use a keyed HMAC, which means that the hashing is of two things together:
 - The message
 - A shared secret, that only the external application and nVotes platform know.

Because hash functions are one-way functions, the resulting HMAC hash can only
be calculated having access to both. Because of that, it serves as a signature. 
nVotes platform can authenticate that the message was generated by an authorized
party by receiving the authentication token, and calculating the HMAC hash by
itself using the message included in the auth-token with the shared secret. If
the resulting hash matches the hash included in the auth-token, nVotes platform
can be confident that the hash was generated by someone with access to the 
shared secret, which means the external application.

The above means that the auth-token cannot be generated in the web-client of the
external application, because that would mean that the shared secret would be
accessible by the voter. The shared secret cannot be accessible by anyone and 
thus needs to remain in the backend servers and not leave them. Of course, in
nVotes platform the same principle applies, and only the backend servers can and
do verify the auth-token, and only in those backend servers the shared secret
resides.

## How to integrate

The integration requires the generation and load of a SmartLink.

TODO

```python
from utils import genhmac
key=b"CBPFVw70eP3Yw7mRWAYcNWi4b8o5oSk2yOUc9hl1"
msg="edulix@nvotes.com:AuthEvent:150017:vote"
genhmac(key, msg)
```