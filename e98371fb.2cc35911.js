(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{137:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/questions_and_voter_groups-e47a3a8212f92b82a5be76fcb1ae395e.svg"},138:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/elections_and_questions-e288445b656ef32aa57e3df5ac5fec8a.svg"},139:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/elections_and_questions_2-bfd4d82d288ce75bbd632812bdfe27cc.svg"},82:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return s})),t.d(n,"metadata",(function(){return r})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return d}));var i=t(3),o=t(7),a=(t(0),t(86)),s={id:"parent-and-children-elections",title:"Parent and Children Elections",sidebar_label:"Parent & Children Elections",slug:"/advanced-elections/parent-and-children-elections"},r={unversionedId:"advanced-elections/parent-and-children-elections",id:"advanced-elections/parent-and-children-elections",isDocsHomePage:!1,title:"Parent and Children Elections",description:"In this document we will review how to create parent and children elections",source:"@site/docs/advanced-elections/parent-children-elections.md",slug:"/advanced-elections/parent-and-children-elections",permalink:"/admin-manual/docs/advanced-elections/parent-and-children-elections",editUrl:"https://github.com/agoravoting/admin-manual/edit/master/docs/advanced-elections/parent-children-elections.md",version:"current",sidebar_label:"Parent & Children Elections",sidebar:"mainSidebar",previous:{title:"Election Creation",permalink:"/admin-manual/docs/advanced-elections/election-creation"},next:{title:"Contribution Guide",permalink:"/admin-manual/docs/contribute/guide"}},l=[{value:"Virtual vs Parent elections",id:"virtual-vs-parent-elections",children:[]},{value:"Parent and children elections",id:"parent-and-children-elections",children:[]},{value:"Basic University elections example",id:"basic-university-elections-example",children:[]}],c={toc:l};function d(e){var n=e.components,s=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(i.a)({},c,s,{components:n,mdxType:"MDXLayout"}),Object(a.b)("p",null,"In this document we will review how to create parent and children elections\nand what are their characteristics."),Object(a.b)("p",null,"Sometimes it's required in advanced elections to have some common questions\navailable for all the electorate, and some other questions available to only\nsome of them. For the common questions you might want to have a tally from\neach of these districts, and also a consolidated tally with all of them."),Object(a.b)("h2",{id:"virtual-vs-parent-elections"},"Virtual vs Parent elections"),Object(a.b)("div",{className:"admonition admonition-info alert alert--info"},Object(a.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-heading"}),Object(a.b)("h5",{parentName:"div"},Object(a.b)("span",Object(i.a)({parentName:"h5"},{className:"admonition-icon"}),Object(a.b)("svg",Object(i.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(a.b)("path",Object(i.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"Enabling Virtual Elections")),Object(a.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-content"}),Object(a.b)("p",{parentName:"div"},"Virtual elections are not enabled by default because for security reasons\nvirtual elections should not be enabled in multi-tenant deployments, as\n",Object(a.b)("inlineCode",{parentName:"p"},"agora-elections")," do not verify that the election creator has permissions for\naccessing the sub-elections."))),Object(a.b)("p",null,"There are two different possible types of relations between\nelections:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"A ",Object(a.b)("a",Object(i.a)({parentName:"li"},{href:"/admin-manual/docs/advanced-elections/election-creation#election-virtual"}),"virtual election")," and its respective\n",Object(a.b)("a",Object(i.a)({parentName:"li"},{href:"/admin-manual/docs/advanced-elections/election-creation#election-virtualSubelections"}),"virtual subelections"),"."),Object(a.b)("li",{parentName:"ol"},"A ",Object(a.b)("a",Object(i.a)({parentName:"li"},{href:"/admin-manual/docs/advanced-elections/election-creation#election-parent_id"}),"parent election")," and its respective\n",Object(a.b)("a",Object(i.a)({parentName:"li"},{href:"/admin-manual/docs/advanced-elections/election-creation#election-children_election_info"}),"children elections"),".")),Object(a.b)("p",null,"The first kind of relation (virtual elections and virtual subelections) is\nestablished in ",Object(a.b)("inlineCode",{parentName:"p"},"agora-elections"),", and its use is allows for electoral results\nconsolidation."),Object(a.b)("p",null,"The second kind of relation is established in ",Object(a.b)("inlineCode",{parentName:"p"},"authapi")," and its use is more\nrelated to the authentication, authorization and presentation behaviour in the\nearlier stages of an election, for example during login."),Object(a.b)("p",null,"Both are closely related/coupled, because usually you want to do both or none.\nThe separation exists simply because ",Object(a.b)("inlineCode",{parentName:"p"},"authapi")," and ",Object(a.b)("inlineCode",{parentName:"p"},"agora-elections")," are\ndifferent modules that have separated databases."),Object(a.b)("h2",{id:"parent-and-children-elections"},"Parent and children elections"),Object(a.b)("p",null,"When a set of election have a parent-children relationship, they have the\nfollowing behaviour:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"In the Admin election list, the children elections are hidden by default and\nonly shown as a dropdown of the parent election."),Object(a.b)("li",{parentName:"ol"},"In the Admin election dashboard, the parent election can manage the children\nelections. For example starting or stopping the parent election starts/stops\nthe children elections automatically. The parent election dashboard also allows\nto trigger the tally of specific subelections with a chooser widget, and also\nallows to switch to see the election results of specific children elections."),Object(a.b)("li",{parentName:"ol"},"In the Admin election Census Data, you can assign to each voter a subset of\nthe children elections, to allow a specific subset of children elections. The\nCensus Data section also allows you to view in which children elections has any\nvoter voted."),Object(a.b)("li",{parentName:"ol"},"In the parent election results public website, there's a chooser widget to\nchoose which children election results to visualize."),Object(a.b)("li",{parentName:"ol"},"In the voting booth, after authentication the voter will vote without having\nto authenticate again in  the assigned children election in their\n",Object(a.b)("a",Object(i.a)({parentName:"li"},{href:"/admin-manual/docs/advanced-elections/election-creation#child-election-natural_order"}),"natural order")," sequentially.\nIf a voter does  not vote to all the children elections assigned to this voter,\nthen he will be able to authenticate again and vote in the next unvoted\nchildren election.")),Object(a.b)("h2",{id:"basic-university-elections-example"},"Basic University elections example"),Object(a.b)("p",null,"Apart from the brief description above, we recommend you delve in to the details\nof election creation reading the\n",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"/admin-manual/docs/advanced-elections/election-creation"}),"election creation documentation")," for reference\ndocumentation."),Object(a.b)("p",null,"In this tutorial we are going to create an university electoral process\ncompromised of 3 different elections. The electoral process contains 3 Yes/No\nquestions:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},Object(a.b)("strong",{parentName:"li"},"For Everyone"),": Do you want John to be the University Dean?"),Object(a.b)("li",{parentName:"ol"},Object(a.b)("strong",{parentName:"li"},"For Students"),": Do you want Mary to be the Students' Representative?"),Object(a.b)("li",{parentName:"ol"},Object(a.b)("strong",{parentName:"li"},"For Professors"),": Do you want Robert to be the Faculty representative?")),Object(a.b)("p",null,Object(a.b)("img",{alt:"Questions and voter groups",src:t(137).default})),Object(a.b)("p",null,"To replicate this, we can use parent and children elections. We would have\nsomething like this:"),Object(a.b)("p",null,Object(a.b)("img",{alt:"Elections and Questions",src:t(138).default})),Object(a.b)("p",null,"In the graphic above the question indexes within each election is indicated\nbetween brackets like ",Object(a.b)("inlineCode",{parentName:"p"},"[0]"),"."),Object(a.b)("p",null,"We will create the elections as described in\n",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"/admin-manual/docs/advanced-elections/election-creation"}),"Election Creation Guide"),". The\n",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"/admin-manual/docs/advanced-elections/election-creation#election-json-settings"}),"Election JSON settings")," will be\nsimilar to the following sketch:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json",metastring:'title="university_elections_1.json"',title:'"university_elections_1.json"'}),'[\n  {\n    "id": 1,\n    "title": "Electoral Process",\n    "children_election_info": {\n      "natural_order": [2, 3],\n      "presentation": {\n        "categories": [\n          {\n            "events": [\n              {"event_id": 2, "title": "Students"},\n              {"event_id": 3, "title": "PRofessors"}\n            ],\n            "id": 2,\n            "title": "Sectors"\n          }\n        ]\n      }\n    },\n    "questions": [\n      {\n        "title": "Q1: Do you want John to be the University Dean?",\n        "answers": [\n          {"id": 0, "text": "Yes"},\n          {"id": 1, "text": "No"}\n        ]\n      },\n      {\n        "title": "Q2: Do you want Mary to be the Students\' Representative?",\n        "answers": [\n          {"id": 0, "text": "Yes"},\n          {"id": 1, "text": "No"}\n        ]\n      },\n      {\n        "title": "Q3: Do you want Robert to be the Faculty representative?",\n        "answers": [\n          {"id": 0, "text": "Yes"},\n          {"id": 1, "text": "No"}\n        ]\n      },\n    ],\n    // ..other properties..\n  },\n  {\n    "id": 2,\n    "title": "Students election",\n    "parent_id": 1,\n    "questions": [\n      {\n        "title": "Q1: Do you want John to be the University Dean?",\n        "answers": [\n          {"id": 0, "text": "Yes"},\n          {"id": 1, "text": "No"}\n        ]\n      },\n      {\n        "title": "Q2: Do you want Mary to be the Students\' Representative?",\n        "answers": [\n          {"id": 0, "text": "Yes"},\n          {"id": 1, "text": "No"}\n        ]\n      }\n    ],\n    // ..other properties..\n  },\n  {\n    "id": 3,\n    "title": "Professors election",\n    "parent_id": 1,\n    "questions": [\n      {\n        "title": "Q1: Do you want John to be the University Dean?",\n        "answers": [\n          {"id": 0, "text": "Yes"},\n          {"id": 1, "text": "No"}\n        ]\n      },\n      {\n        "title": "Q3: Do you want Robert to be the Faculty representative?",\n        "answers": [\n          {"id": 0, "text": "Yes"},\n          {"id": 1, "text": "No"}\n        ]\n      }\n    ],\n    // ..other properties..\n  }\n]\n')),Object(a.b)("p",null,"That's the configuration regarding the questions and the parent-children\nrelations. See\n",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"/admin-manual/docs/advanced-elections/election-creation#election-children_election_info"}),"children_election_info"),"\nfor details."),Object(a.b)("p",null,"In reality, the questions set in the parent election are not used for much. For\nresults' consolidation in the parent election you could just use the appropiate\n",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"/admin-manual/docs/advanced-elections/election-creation#results-config-pipes"}),"Results Config Pipes")," to clone the\nelection from the subelections. We will do something similar later on. Note\nhowever that it's  required for all election to be created with at least one\nquestion."),Object(a.b)("p",null,"What follows is a more is the same JSON configuration but we only sketched the\ninformation regarding the virtual elections and\n",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"/admin-manual/docs/advanced-elections/election-creation#results-config-pipes"}),"results config pipes"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json",metastring:'title="university_elections_2.json"',title:'"university_elections_2.json"'}),'[\n  {\n    "id": 1,\n    "virtual": true,\n    "virtualSubelections": [2,3],\n    "resultsConfig": [\n      [\n        // We source votes from source subelection questions to the \n        // appropiate virtual election questions.\n        "agora_results.pipes.multipart.multipart_tally_plaintexts_append_joiner",\n        {\n          "mappings": [\n            {\n              // From: Students Election #2 | Q1\n              "source_election_id": 1,\n              "source_question_num": 0,\n              // To: Electoral Process #1 | Q1\n              "dst_election_id": 0,\n              "dst_question_num": 0\n            },\n            {\n              // From: Professors Election #3 | Q1\n              "source_election_id": 2,\n              "source_question_num": 0,\n              // To: Electoral Process #1 | Q1\n              "dst_election_id": 0,\n              "dst_question_num": 0\n            },\n            {\n              // From: Students Election #2 | Q2\n              "source_election_id": 1,\n              "source_question_num": 1,\n              // To: Electoral Process #1 | Q2\n              "dst_election_id": 0,\n              "dst_question_num": 1\n            },\n            {\n              // From: Professors Election #3 | Q3\n              "source_election_id": 2,\n              "source_question_num": 1,\n              // To: Electoral Process #1 | Q3\n              "dst_election_id": 0,\n              "dst_question_num": 2\n            },\n          ]\n        }\n      ]\n      ["agora_results.pipes.results.do_tallies", {}],\n      ["agora_results.pipes.sort.sort_non_iterative", {}]\n    ]\n    // .. other properties..\n  },\n  {\n    "id": 2,\n    "resultsConfig": [\n      ["agora_results.pipes.results.do_tallies", {}],\n      ["agora_results.pipes.sort.sort_non_iterative", {}]\n    ]\n    // .. other properties..\n  },\n  {\n    "id": 3,\n    "resultsConfig": [\n      ["agora_results.pipes.results.do_tallies", {}],\n      ["agora_results.pipes.sort.sort_non_iterative", {}]\n    ]\n    // .. other properties..\n  },\n]\n')),Object(a.b)("p",null,"The juice of this part is in the ",Object(a.b)("inlineCode",{parentName:"p"},"resultsConfig")," for the virtual election (id=1). As\n",Object(a.b)("inlineCode",{parentName:"p"},"agora-results")," doesn't know the id of the subelections, it references to the\nsubelections by array index. The virtual election (Electoral Process, id 1) has\nalways array index 1. Then the sub-elections are indexed in the order of\nappeareance in the ",Object(a.b)("inlineCode",{parentName:"p"},"virtualSubelections")," property. Thus, within ",Object(a.b)("inlineCode",{parentName:"p"},"agora-results"),"\nthe indexes of elections transform this way:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Electoral Process #1 => Election Index 0"),Object(a.b)("li",{parentName:"ul"},"Students Election #2 => Election Index 1"),Object(a.b)("li",{parentName:"ul"},"Professors Election #3 => Election Index 2")),Object(a.b)("p",null,"We are using the ",Object(a.b)("inlineCode",{parentName:"p"},"multipart_tally_plaintexts_append_joiner")," pipe to source\nballots from the subelections to the virtual election for results consolidation."),Object(a.b)("p",null,"We could further improve the ",Object(a.b)("inlineCode",{parentName:"p"},"Electoral Process #1")," election results to contain\nthere all the electoral information and not just consolidated elections. We could\nclone twice Q1 and adjust the title of the cloned questions to do something\nlike:"),Object(a.b)("p",null,Object(a.b)("img",{alt:"Elections and Questions Improved",src:t(139).default})," "),Object(a.b)("p",null,"The configuration file sketch would be:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json",metastring:'title="university_elections_3.json"',title:'"university_elections_3.json"'}),'[\n  {\n    "id": 1,\n    "virtual": true,\n    "virtualSubelections": [2,3],\n    "resultsConfig": [\n      [\n        // We duplicate Q1 in election 0 (Electoral Process #1) into\n        // question indexes 1 and 2 for students and professors, \n        // with empty ballots as votes will be sourced later with the \n        // multipart_tally_plaintexts_append_joiner pipe.\n        "agora_results.pipes.duplicate_questions.duplicate_questions",\n        {\n          "duplications": [\n            {\n              "source_election_index": 0,\n              "base_question_index": 0,\n              "duplicated_question_indexes": [1,2],\n              "zero_plaintexts": true\n            }\n          ]\n        }\n      ],\n\n      [\n        "agora_results.pipes.modifications.apply_modifications",\n        {\n          "modifications": [\n            {\n              "action": "set-title",\n              "question_index": 0,\n              "title": "Q1 all: Do you want John to be the University Dean?"\n            },\n            {\n              "action": "set-title",\n              "question_index": 1,\n              "title": "Q1 students: Do you want John to be the University Dean?"\n            },\n            {\n              "action": "set-title",\n              "question_index": 2,\n              "title": "Q1 professors: Do you want John to be the University Dean?"\n            }\n          ]\n        }\n      ],\n      [\n        // We source votes from source subelection questions to the\n        // appropiate virtual election questions.\n        "agora_results.pipes.multipart.multipart_tally_plaintexts_append_joiner",\n        {\n          "mappings": [\n            {\n              // From: Students Election #2 | Q1\n              "source_election_id": 1,\n              "source_question_num": 0,\n              // To: Electoral Process #1 | Q1 all\n              "dst_election_id": 0,\n              "dst_question_num": 0\n            },\n            {\n              // From: Students Election #2 | Q1\n              "source_election_id": 1,\n              "source_question_num": 0,\n              // To: Electoral Process #1 | Q1 students\n              "dst_election_id": 0,\n              "dst_question_num": 1\n            },\n            {\n              // From: Professors Election #3 | Q1\n              "source_election_id": 2,\n              "source_question_num": 0,\n              // To: Electoral Process #1 | Q1 all\n              "dst_election_id": 0,\n              "dst_question_num": 0\n            },\n            {\n              // From: Professors Election #3 | Q1\n              "source_election_id": 2,\n              "source_question_num": 0,\n              // To: Electoral Process #1 | Q1 professors\n              "dst_election_id": 0,\n              "dst_question_num": 2\n            },\n            {\n              // From: Students Election #2 | Q2\n              "source_election_id": 1,\n              "source_question_num": 1,\n              // To: Electoral Process #1 | Q2\n              "dst_election_id": 0,\n              "dst_question_num": 3\n            },\n            {\n              // From: Professors Election #3 | Q3\n              "source_election_id": 2,\n              "source_question_num": 1,\n              // To: Electoral Process #1 | Q3\n              "dst_election_id": 0,\n              "dst_question_num": 4\n            },\n          ]\n        }\n      ]\n      ["agora_results.pipes.results.do_tallies", {}],\n      ["agora_results.pipes.sort.sort_non_iterative", {}]\n    ]\n    // .. other properties..\n  },\n  {\n    "id": 2,\n    "resultsConfig": [\n      ["agora_results.pipes.results.do_tallies", {}],\n      ["agora_results.pipes.sort.sort_non_iterative", {}]\n    ]\n    // .. other properties..\n  },\n  {\n    "id": 3,\n    "resultsConfig": [\n      ["agora_results.pipes.results.do_tallies", {}],\n      ["agora_results.pipes.sort.sort_non_iterative", {}]\n    ]\n    // .. other properties..\n  },\n]\n')))}d.isMDXComponent=!0},86:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return h}));var i=t(0),o=t.n(i);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var c=o.a.createContext({}),d=function(e){var n=o.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=d(e.components);return o.a.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},b=o.a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=d(t),b=i,h=u["".concat(s,".").concat(b)]||u[b]||p[b]||a;return t?o.a.createElement(h,r(r({ref:n},c),{},{components:t})):o.a.createElement(h,r({ref:n},c))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,s=new Array(a);s[0]=b;var r={};for(var l in n)hasOwnProperty.call(n,l)&&(r[l]=n[l]);r.originalType=e,r.mdxType="string"==typeof e?e:i,s[1]=r;for(var c=2;c<a;c++)s[c]=t[c];return o.a.createElement.apply(null,s)}return o.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);